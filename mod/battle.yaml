---
# 这里有个视角的问题
# 在攻击的时候，获取变量人物属性默认是攻击者/行动者
# 防守特效，获取的默认变量人物是挨打者
# 集气特效，是集气者 -》集气特效只能作用于自己！
# 这是第一个概念 
# 第二个是，特效在攻击和防御者同时有时怎么相加
# 比如暴击（最终伤害放大）
# 这个作用于全局和攻击时，是增加攻击者的最终输出
# 作用于防守时，也是增加攻击者的输出！！
# 一般来说，公式是这样的
# 特效威力 = 攻击方特效参数+ 防守方特效参数
# 所以防御方要写负数参数，才能减伤
# 第三个，在给敌方上负面状态/时序特效时，敌方是谁
# 1. 攻击/敌方特效: 敌方就是你打的人
# 2. 防守特效: 敌方就是打你的人
# 那我想给自己上状态（比如说负数）呢？
# 请使用 给自己上状态

特效:
  - 编号: &tx_weili 0 
    描述: 加成武功威力
    #有效: 攻击，防守
    #效果参数: 
    #  - 加成数值

  - 编号: &tx_qigong 1
    描述: 增加集气伤害
    #有效: 攻击，防守
    #效果参数: 
    #  - 增加数值

  - 编号: &tx_qifang 2
    描述: 集气伤害护体
    #有效: 攻击，防守
    #效果参数: 
    #  - 护体数值

  - 编号: &tx_jiqisudu 3
    描述: 增加集气速度
    #有效: 集气
    #备注: 只对自己有效
    #效果参数: 
    #  - 加快数值
      
  - 编号: &tx_baoji 4
    描述: 最终伤害放大
    #有效: 攻击
    #备注：这是攻击方视角，负数会减少攻击者造成的伤害
    #效果参数:
    #  - 伤害增强百分比
    
  - 编号: &tx_shanghai 5
    描述: 最终伤害增加
    #有效: 攻击
    #备注：先暴击后加伤害，建议选择特效1武功威力
    #效果参数:
    #  - 伤害值增加数量
    
  - 编号: &tx_diren_status 6
    描述: 给敌方上状态
    #有效: 攻击
    #备注: 在伤害计算结束后生效, 状态 += 强度
    #效果参数:
    #  - 状态编号
    #  - 强度(0~100)
    
  - 编号: &tx_ziji_status 7
    描述: 给自己上状态
    #有效: 集气，攻击
    #备注: 攻击时在行动结束时结算, 状态 += 强度
    #效果参数:
    #  - 状态编号
    #  - 强度(0~100)
    
  - 编号: &tx_diren_qiangzhi_status 8
    描述: 对敌人强制设置状态
    #有效: 攻击，防守
    #备注: 强制状态，立即结算, 状态 = 强度
    # 立即结算的意思是指，
    # 攻击：在攻击特效判断完之后立马结算
    # 防守：在防御特效判断完之后立马结算
    # 集气: 在“给自己上状态”之前
    # 并且清空暂时状态
    #效果参数:
    #  - 状态编号
    #  - 强度(0~100)

  - 编号: &tx_ziji_qiangzhi_status 9
    描述: 对自己强制设置状态
    #有效: 所有
    #备注: 强制状态，仅限自己，立即结算, 状态 = 强度
    #效果参数:
    #  - 状态编号
    #  - 强度(0~100)

  - 编号: &tx_jiqisudu_percentage 10
    描述: 集气速度百分比
    #有效: 集气，攻击
    #备注: 不想写

  - 编号: &tx_lianji 11
    描述: 连击
    #有效: 攻击
    #备注: 攻击次数+1，注意如果不控制的话就是无限连击
    #传统双手互博，既学了就打两下，可用proc_counter控制触发
    #这里我给的是学了互博增加连击率，且看我是怎么操作不让他无限连击的

  - 编号: &tx_jiqizhi 12
    描述: 集气值
    #有效: 攻击，防御，回合
    #备注: 集气阶段就算了
  
发动方式:
  - 编号: &proc_random 0
    #描述: 单独随机发动，判断一次，发动一到多个特效
    #发动参数:
    #  - 百分比发动几率
  - 编号: &proc_distributed 1
    #描述: 池分布式随机发动
    #总比重: 总体比重
    #发动参数:
    #  - 每项的单体比重
  - 编号: &proc_prioritized 2
    #描述: 优先发动，第一个成功后便停止判断
    #发动参数:
    #  - 百分比发动几率

  # 等我实验一下再说
  - 编号: &proc_counter 3
    #描述: 计数发动，这里有个记谁头上的问题，这里统一按照人物id来
    #既，这个特效，这个人物，尝试了3次，那么发动，如果发动的时候没人物id?(为啥)，那么作废
    #计数: 计数器到达这个值就发动
    #发动参数:
    #  - 每次判断增加计数器几次
    #  下面这个还没做
    #  - 1: 第一次既触发(默认否), 0: 第一次不算
    # 问题是 问题是啥？
      
# 本人设计问题，所有字符串都是存在一个vector里，避免复制
# 但是vector更新容量就会使引用失效，优雅的解决方案暂时没想到
# 所以先确保vector大小，既总共没有超过这么多个字符串
字符串数组大小: 5000      

对比:
  - &op_greater 0         # 大于
  - &op_greater_equal 1   # 大于等于
  - &op_equal 2           # 等于

对象:
  - &target_self 0
  - &target_other 1

变量: 
  # 变量: {编号: *var_char_mptype, 对象: *target_self}
  # 对象默认当前角色
  - &var_char_sex 0               # 性别  0 男 1 女 2 其他
  - &var_char_level 1             # 等级
  - &var_char_exp 2               # 经验
  - &var_char_hp 3                # 生命值
  - &var_char_maxhp 4             # 最大生命值
  - &var_char_equip0 5            # 武器
  - &var_char_equip1 6            # 防具
  - &var_char_mptype 7            # 内力属性
  - &var_char_mp 8                # 内力值
  - &var_char_maxmp 9             # 内力最大值
  - &var_char_attack 10           # 攻击
  - &var_char_speed 11            # 轻功
  - &var_char_defence 12          # 防御
  - &var_char_medicine 13         # 医疗
  - &var_char_usepoison 14        # 用毒
  - &var_char_detoxification 15   # 解毒, 机器猫老师英文NB
  - &var_char_antipoison 16       # 抗毒
  - &var_char_fist 17             # 拳
  - &var_char_sword 18            # 剑
  - &var_char_blade 19            # 刀，我拒绝用knife
  - &var_char_unusual 20          # 奇门
  - &var_char_hiddenweapon 21     # 暗器
  - &var_char_knowledge 22        # 武学常识
  - &var_char_morality 23         # 道德
  - &var_char_attackwithpoison 24 # 攻击带毒
  - &var_char_attacktwice 25      # 双手互博
  - &var_char_fame 26             # 声望
  - &var_char_iq 27               # 资质
  
  
  # 触发特效的选手
  - &var_using_char 28

  # 天书数量，仅友方有效，敌方算0
  - &var_books 29
  
  # 武功等级，仅适用于当前使用武功，否则为0
  - &var_cur_wg_level 30
  
  # 变量: {编号: *var_wg_level, 参数: *wg_yeqiuquan}
  # 返回武功等级，给武功编号
  - &var_wg_level 31
  
  # 变量: {编号: *var_count_item, 参数: *item_tulongdao}
  # 数有几个物品，需要给物品ID
  - &var_count_item 32

  # 变量: {编号: *var_has_wg, 参数: [*wg_yeqiuquan..]}
  # 也可以单个
  # 1: 拥有武功, 0: 没有
  - &var_has_wg 33

  # 武功类型
  - &var_wg_type 34

  # 变量: {编号: *var_is_person, 参数: *char_zhujue}
  # 1: 是指定角色 0: 不是
  - &var_is_person 35

  # 变量: {编号: *var_has_status, 参数: [*status_nuqi, 100]}
  # 指定状态是否达到指定值，达到返回1 否则0
  - &var_has_status 36

  # 武功威力
  - &var_wg_power 37


#####################################################################  
  
# 根据MOD，自行定义
人物编号锚点:
  # 主角
  - &char_zhujue 0
  - &char_zhoubotong 64 #我的测试对象
  
武功编号锚点:
  # 野球拳
  - &wg_yeqiuquan 1


# 所有敌人的状态结算是在伤害之后
# 攻击者的状态结算则是在行动之后（包括行动特效）
# 所以在回合开始前大家有一个状态，然后在结算之前这个状态不会被更新
# 所有特效加加减减全是临时的，此时用变量访问状态是不包含这些临时状态的
战场状态:
  # 0,1,2 是写死的 不能动
  - 编号: &status_neishang 0
    描述: 内伤
    颜色: [255, 140, 0, 255]      # 橙色
  - 编号: &status_zhongdu 1
    描述: 中毒
    颜色: [47, 79, 47, 255]       # 保护色
  - 编号: &status_tili 2
    描述: 体力
    颜色: [255, 218, 185, 255]    # ??体力的颜色
  - 编号: &status_nuqi 3
    描述: 怒气
    满值: 100
    颜色: [160, 32, 240, 255]     # 紫色
  - 编号: &status_fengxue 4
    描述: 封穴
    满值: 100
    颜色: [50, 153, 204, 255]     # 天蓝
  - 编号: &status_hubo 5
    描述: 互搏计数器
    隐藏: true
    满值: 1
  - 编号: &status_waishang 6
    描述: 外伤
    满值: 100
    颜色: [255, 105, 180, 255]    # 粉

#主动运功: 这个要写好多好多UI，在此之前不碰
    
# 每个武功可以有 主动攻击 被动攻击/防守(程序会判断是否拥有武功)
# 武功:

# 所有人都一样
全人物:
  攻击:
    # 暴击
    - 发动方式: *proc_random
      # 发动概率 = 10% + 内力*0.5% + 资质*0.2%
      发动参数:
        可变参数:
          基础: 10
          加成:
            # 可以有多个线性加成
            # 200内力 = 5%几率
            - 线性: {系数: 0.025, 变量: {编号: *var_char_mp}}
            # 1资质 = 0.2%
            - 线性: {系数: 0.2, 变量: {编号: *var_char_iq}}
            # 怒气爆发 必暴击
            - 线性: {系数: 100, 变量: {编号: *var_has_status, 参数: [*status_nuqi, 100]}}
      特效:
        编号: *tx_baoji
        显示: 暴击
        # 50%伤害提升
        效果参数:  50

    # 连击，仅仅学了左右互博可以发动
    # 发动概率是 60 - 资质
    - 发动方式: *proc_random
      需求:
        - 条件: 
          - 左边: 
              变量: {编号: *var_char_attacktwice}
            对比: *op_equal
            右边: 1
          - 左边:
              状态: *status_hubo
            对比: *op_equal
            右边: 0
      发动参数:
        可变参数:
          基础: 60
          加成:
            - 线性: {系数: -1, 变量: {编号: *var_char_iq}}
            # 周伯通+20%触发率
            - 线性: {系数: 20, 变量: {编号: *var_is_person, 参数: *char_zhoubotong}}
      特效:
        - 编号: *tx_lianji
          显示: '连击'
          效果参数: 1
        - 编号: *tx_ziji_qiangzhi_status
          显示: ''
          效果参数: [*status_hubo, 1]


    # 拳增加封穴值，发动率为兵器值，武功威力/100
    - 发动方式: *proc_random
      需求:
        - 条件:
          - 左边:
              变量: {编号: *var_wg_type}
            对比: *op_equal
            右边: 1
      发动参数: 
        可变参数:
          基础: 0
          加成:
            - 线性: {系数: 1, 变量: {编号: *var_char_fist}}
      特效:
        - 编号: *tx_diren_status
          显示: '拳掌封穴'
          效果参数:
            - *status_fengxue
            - 可变参数:
                基础: 0
                加成:
                  - 线性: {系数: 0.01, 变量: {编号: *var_wg_power}}

    # 剑增加集气值，发动率为兵器值，武功威力/5
    - 发动方式: *proc_random
      需求:
        - 条件:
          - 左边:
              变量: {编号: *var_wg_type}
            对比: *op_equal
            右边: 2
      发动参数: 
        可变参数:
          基础: 0
          加成:
            - 线性: {系数: 1, 变量: {编号: *var_char_sword}}
      特效:
        - 编号: *tx_diren_status
          显示: '御剑加速'
          效果参数:
            可变参数:
              基础: 0
              加成:
                - 线性: {系数: 0.2, 变量: {编号: *var_wg_power}}

    # 刀增加外伤值，发动率为兵器值，武功威力/10
    - 发动方式: *proc_random
      需求:
        - 条件:
          - 左边:
              变量: {编号: *var_wg_type}
            对比: *op_equal
            右边: 3
      发动参数: 
        可变参数:
          基础: 0
          加成:
            - 线性: {系数: 1, 变量: {编号: *var_char_blade}}
      特效:
        - 编号: *tx_diren_status
          显示: '耍刀外伤'
          效果参数:
            可变参数:
              基础: 0
              加成:
                - 线性: {系数: 0.1, 变量: {编号: *var_wg_power}}

    # 特殊减少怒气，发动率为兵器值，武功威力/15
    - 发动方式: *proc_random
      需求:
        - 条件:
          - 左边:
              变量: {编号: *var_wg_type}
            对比: *op_equal
            右边: 4
      发动参数: 
        可变参数:
          基础: 0
          加成:
            - 线性: {系数: 1, 变量: {编号: *var_char_unusual}}
      特效:
        - 编号: *tx_diren_status
          显示: '特殊降怒'
          效果参数:
            - *status_nuqi
            - 可变参数:
                基础: 0
                加成:
                  - 线性: {系数: -0.067, 变量: {编号: *var_wg_power}}               

  防守:
    - 发动方式: *proc_random
      发动参数: 100
      特效:
        -
          # 根据外伤值决定受到增加的伤害
          编号: *tx_shanghai
          显示: '外伤伤害'
          效果参数:
            - 可变参数:
                基础: 0
                加成:
                  - 线性: {系数: 1, 状态: *status_waishang}
        - 
          # 挨打受到怒气，随机25到35点
          编号: *tx_ziji_status
          显示: '伤害怒气'
          效果参数:
            - *status_nuqi
            - 可变参数:
                基础: 0
                加成: 
                  - 随机:
                      范围: {最小: 25, 最大: 35}        
          
  集气:
    #基础集气速度为 0.25*轻功 + 0.002*内力 + 5
    - 发动方式: *proc_random
      发动参数: 100
      特效:
        编号: *tx_jiqisudu
        显示: ''
        效果参数:
          - 可变参数:
              基础: 10
              加成:
                # 100内力=1点
                - 线性: {系数: 0.01, 变量: {编号: *var_char_mp}}
                # 10轻功=1点
                - 线性: {系数: 0.1, 变量: {编号: *var_char_speed}}
                # 每10点内伤降低1点集气速度
                - 线性: {系数: -0.1, 状态: *status_neishang}

    # 暴怒+100%集气速度
    - 发动方式: *proc_random
      发动参数: 100
      需求:
        - 条件: 
          - 左边: 
              状态: *status_nuqi
            对比: *op_greater_equal
            右边: 100
      特效:
        编号: *tx_jiqisudu_percentage
        显示: '暴怒加速'
        效果参数: 100
        
    # 封穴降低100%的速度，可以被暴怒解开，以后可以加入特效直接停止集气
    - 发动方式: *proc_random
      发动参数: 100
      需求:
        - 条件: 
          - 左边: 
              状态: *status_fengxue
            对比: *op_greater_equal
            右边: 1
      特效:
        编号: *tx_jiqisudu_percentage
        显示: '封穴减速'
        效果参数: -100        

    # 每时序解开一点封穴
    - 发动方式: *proc_random
      发动参数: 100
      需求:
        - 条件: 
          - 左边: 
              状态: *status_fengxue
            对比: *op_greater_equal
            右边: 1
      特效:
        编号: *tx_ziji_status
        显示: '时解封穴'
        效果参数: [*status_fengxue, -1]  

  回合:
    # 行动结束怒气-100
    - 发动方式: *proc_random
      发动参数: 100
      需求:
        - 条件: 
          - 左边: 
              状态: *status_nuqi
            对比: *op_greater_equal
            右边: 100
      特效:
        编号: *tx_ziji_status
        显示: '结束去怒'
        效果参数: [*status_nuqi, -100]

    # 重置互博计数
    - 发动方式: *proc_random
      # 需求貌似无所谓，不过无所谓
      需求:
        - 条件: 
          - 左边: 
              变量: {编号: *var_char_attacktwice}
            对比: *op_equal
            右边: 1
      发动参数: 100
      特效:
        - 编号: *tx_ziji_qiangzhi_status
          显示: ''
          效果参数: [*status_hubo, 0]
          
人物:
  - 人物编号: *char_zhujue
    集气:
      - 发动方式: *proc_random
        发动参数: 100
        特效:
          编号: *tx_jiqizhi
          显示: '主角加成集气' # 无显示，留空
          效果参数: 10
          